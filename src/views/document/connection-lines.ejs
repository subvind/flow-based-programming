<script>
  function drawConnectionLines() {
    const svg = document.getElementById('connection-lines');
    if (!svg) {
      const newSvg = document.createElementNS('http://www.w3.org/2000/svg', 'svg');
      newSvg.id = 'connection-lines';
      document.body.appendChild(newSvg);
    }
    
    // Clear existing lines
    document.getElementById('connection-lines').innerHTML = '';
    
    const components = document.querySelectorAll('.component-wrapper');
    components.forEach(fromComponent => {
      const fromComponentId = fromComponent.id;
      const outputPorts = fromComponent.querySelectorAll('.output-port');
      
      outputPorts.forEach(outputPort => {
        const fromEvent = outputPort.dataset.port;
        
        // Find connections for this output port
        const connections = window.flowConnections.filter(conn => 
          conn.fromComponent === fromComponentId.split('.')[1] && 
          conn.fromEvent === fromEvent.split('.')[2]
        );
        
        connections.forEach(connection => {
          const toComponentId = `${connection.toFlow}.${connection.toComponent}`;
          const toComponent = document.getElementById(toComponentId);
          
          if (toComponent) {
            const inputPort = toComponent.querySelector(`.input-port[data-port$=".${connection.toEvent}"]`);
            if (inputPort) {
              drawLine(outputPort, inputPort);
            }
          }
        });
      });
    });
  }

  function drawLine(start, end) {
    const svg = document.getElementById('connection-lines');
    const line = document.createElementNS('http://www.w3.org/2000/svg', 'line');
    
    const startRect = start.getBoundingClientRect();
    const endRect = end.getBoundingClientRect();
    
    const startX = startRect.right;
    const startY = startRect.top + startRect.height / 2;
    const endX = endRect.left;
    const endY = endRect.top + endRect.height / 2;
    
    line.setAttribute('x1', startX);
    line.setAttribute('y1', startY);
    line.setAttribute('x2', endX);
    line.setAttribute('y2', endY);
    line.setAttribute('stroke', 'black');
    line.setAttribute('stroke-width', '1');
    
    svg.appendChild(line);
  }

  window.addEventListener('resize', drawConnectionLines);

  // This function should be called when the flow data is loaded
  function initializeFlowConnections(flowConnections) {
    window.flowConnections = flowConnections;
    drawConnectionLines();
  }
</script>