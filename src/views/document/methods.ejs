<script>
  function loadConnectedComponents(direction, flowId, componentId, port, swimlaneId) {
    const mainSwimlane = document.getElementById(swimlaneId);
    const mainIndex = parseInt(mainSwimlane.getAttribute('data-index'));
    
    let targetIndex, targetSwimlane;
    if (direction === 'input') {
      targetIndex = mainIndex - 1;
      targetSwimlane = getOrCreateSwimlane(targetIndex);
    } else {
      targetIndex = mainIndex + 1;
      targetSwimlane = getOrCreateSwimlane(targetIndex);
    }

    const eventElement = document.createElement('div');
    eventElement.setAttribute("id", `${flowId}.${componentId}.${port}`);
    targetSwimlane.innerHTML = '';
    targetSwimlane.appendChild(eventElement);
    
    htmx.ajax('GET', `/document/${flowId}/${componentId}/${port}/${targetSwimlane.id}`, {
      swap: 'none',
      handler: (dom, event) => {
        document.getElementById(`${flowId}.${componentId}.${port}`).outerHTML = event.xhr.response;
      }
    });
  }

  function loadMainComponent(flowId, componentId, swimlaneId) {
    // Update the main swimlane
    const mainSwimlane = document.getElementById(swimlaneId);
    mainSwimlane.setAttribute('data-index', '0');
    mainSwimlane.innerHTML = '';
    
    htmx.ajax('GET', `/document/${flowId}/${componentId}/${swimlaneId}`, {
      swap: 'none',
      handler: (dom, event) => {
        mainSwimlane.innerHTML = event.xhr.response;
      }
    });
  }

  function getOrCreateSwimlane(index) {
    let swimlane = document.querySelector(`.swimlane[data-index="${index}"]`);
    if (!swimlane) {
      swimlane = document.createElement('div');
      swimlane.className = 'swimlane';
      swimlane.setAttribute('data-index', index);
      swimlane.id = `swimlane-${index}`;
      
      const container = document.getElementById('swimlane-container');
      if (index < 0) {
        container.insertBefore(swimlane, container.firstChild);
      } else {
        container.appendChild(swimlane);
      }
    }
    return swimlane;
  }
</script>